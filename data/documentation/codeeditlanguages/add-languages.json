{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"First of all have a look at the corresponding "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/CodeEditApp\/CodeEditTextView\/issues\/15"},{"type":"text","text":" to see which languages still need implementation."}]},{"style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to update existing languages see "},{"type":"reference","isActive":true,"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/Update-Languages"},{"type":"text","text":" instead."}]}],"type":"aside","name":"Note"},{"anchor":"Add-SPM-support","level":2,"type":"heading","text":"Add SPM support"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you find one you want to add, fork and clone the linked repo and create a new branch "},{"type":"codeVoice","code":"feature\/spm"},{"type":"text","text":"."}]},{"style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"In the following code samples replace "},{"type":"codeVoice","code":"{LANG}"},{"type":"text","text":" or "},{"type":"codeVoice","code":"{lang}"},{"type":"text","text":" with the language you add (e.g.: "},{"type":"codeVoice","code":"Swift"},{"type":"text","text":" or "},{"type":"codeVoice","code":"CPP"},{"type":"text","text":" and "},{"type":"codeVoice","code":"swift"},{"type":"text","text":" or "},{"type":"codeVoice","code":"cpp"},{"type":"text","text":" respectively)"}]}],"type":"aside","name":"Tip"},{"anchor":"gitignore","level":3,"type":"heading","text":".gitignore"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Edit the "},{"type":"codeVoice","code":".gitignore"},{"type":"text","text":" file to exclude the "},{"type":"codeVoice","code":".build\/"},{"type":"text","text":" directory from git."}]},{"anchor":"Packageswift","level":3,"type":"heading","text":"Package.swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a new file "},{"type":"codeVoice","code":"Package.swift"},{"type":"text","text":" in the "},{"type":"codeVoice","code":"root"},{"type":"text","text":" directory of the repository and add the following configuration."}]},{"style":"warning","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Make sure to remove the comment in ‘sources’."}]}],"type":"aside","name":"Warning"},{"type":"codeListing","syntax":"swift","code":["\/\/ swift-tools-version:5.3","import PackageDescription","","let package = Package(","    name: \"TreeSitter{LANG}\",","    platforms: [.macOS(.v10_13), .iOS(.v11)],","    products: [","        .library(name: \"TreeSitter{LANG}\", targets: [\"TreeSitter{LANG}\"]),","    ],","    dependencies: [],","    targets: [","        .target(name: \"TreeSitter{LANG}\",","                path: \".\",","                exclude: [","                    \"binding.gyp\",","                    \"bindings\",","                    \"Cargo.toml\",","                    \"corpus\",","                    \"examples\",","                    \"grammar.js\",","                    \"LICENSE\",","                    \"Makefile\",","                    \"package.json\",","                    \"README.md\",","                    \"src\/grammar.json\",","                    \"src\/node-types.json\",","                    \/\/ any additional files to exclude ","                ],","                sources: [","                    \"src\/parser.c\",","                    \"src\/scanner.cc\", \/\/ this might be `scanner.c` or not present at all","                ],","                resources: [","                    .copy(\"queries\")","                ],","                publicHeadersPath: \"bindings\/swift\",","                cSettings: [.headerSearchPath(\"src\")])","    ]",")"]},{"anchor":"Swift-Bindings","level":3,"type":"heading","text":"Swift Bindings"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now you need to create the Swift bindings which are a "},{"type":"codeVoice","code":"header"},{"type":"text","text":" file exposing the "},{"type":"codeVoice","code":"tree_sitter_{lang}()"},{"type":"text","text":" function."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"First of all create the following directories inside the "},{"type":"codeVoice","code":"bindings\/"},{"type":"text","text":" directory:"}]},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":".\/bindings\/swift\/TreeSitter{LANG}\/"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Inside that folder create a new header file called "},{"type":"codeVoice","code":"{lang}.h"},{"type":"text","text":"."}]},{"type":"codeListing","syntax":"cpp","code":["#ifndef TREE_SITTER_{LANG}_H_","#define TREE_SITTER_{LANG}_H_","","typedef struct TSLanguage TSLanguage;","","#ifdef __cplusplus","extern \"C\" {","#endif","","extern TSLanguage *tree_sitter_{lang}();","","#ifdef __cplusplus","}","#endif","","#endif \/\/ TREE_SITTER_{LANG}_H_"]},{"anchor":"Add-it-to-CodeEditLanguages","level":2,"type":"heading","text":"Add it to CodeEditLanguages"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In order to add a language to "},{"type":"reference","isActive":true,"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages"},{"type":"text","text":" you need to open the "},{"type":"codeVoice","code":".xcodeproj"},{"type":"text","text":" file located inside "},{"type":"codeVoice","code":"CodeLanguage-Container"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"xcodeproj-location"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add the "},{"type":"codeVoice","code":"tree-sitter"},{"type":"text","text":" package you created earlier as a dependency like you would in a regular Xcode project."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Then make sure the framework target loads the package module."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Now open the "},{"type":"codeVoice","code":"CodeLanguages_Container.h"},{"type":"text","text":" header file and add:"}]},{"type":"codeListing","syntax":"cpp","code":["extern TSLanguage *tree_sitter_{lang}();"]},{"style":"important","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Please keep an alphabetical order"}]}],"type":"aside","name":"Important"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Now create the "},{"type":"codeVoice","code":"xcframework"},{"type":"text","text":" by running the "},{"type":"codeVoice","code":"build_framework.sh"},{"type":"text","text":" script from the Package’s root directory."}]},{"type":"codeListing","syntax":"bash","code":["$ .\/build_framework.sh"]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Check the output of the script. It should say "},{"type":"codeVoice","code":"Done!"},{"type":"text","text":" at the end."},{"type":"text","text":" "},{"type":"image","identifier":"build-output"}]},{"style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If this does not succeed, try running the script using the "},{"type":"codeVoice","code":"--debug"},{"type":"text","text":" flag to get verbose output:"}]},{"type":"codeListing","syntax":"bash","code":["$ .\/build_framework.sh --debug"]}],"type":"aside","name":"Tip"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You are now done in the Xcode Project and may close it now. Open the Package and continue."}]}]}]},{"anchor":"Add-it-to-CodeLanguage","level":2,"type":"heading","text":"Add it to CodeLanguage"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now move over to the "},{"type":"codeVoice","code":"Sources\/CodeEditLanguages"},{"type":"text","text":" folder where 3 files need to be updated."}]},{"anchor":"TreeSitterLanguageswift","level":3,"type":"heading","text":"TreeSitterLanguage.swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Add a case for your language to "},{"type":"reference","isActive":true,"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterLanguage"},{"type":"text","text":":"}]},{"type":"codeListing","syntax":"swift","code":["public enum TreeSitterLanguage: String {","    \/\/ other cases","    case {lang}","}"]},{"anchor":"CodeLanguageswift","level":3,"type":"heading","text":"CodeLanguage.swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Find the "},{"type":"codeVoice","code":"tsLanguage"},{"type":"text","text":" computed property and add a "},{"type":"codeVoice","code":"case"},{"type":"text","text":" to it:"}]},{"type":"codeListing","syntax":"swift","code":["private var tsLanguage: UnsafeMutablePointer<TSLanguage>? {","    switch id {","    \/\/ other cases","    case .{lang}:","        return tree_sitter_{lang}()","    }","    \/\/ other cases","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"On the bottom of the file add a new "},{"type":"codeVoice","code":"static"},{"type":"text","text":" constant:"}]},{"type":"codeListing","syntax":"swift","code":["static let {lang}: CodeLanguage = .init(","    id: .{lang}, ","    tsName: {lang}, ","    extensions: [...]",")"]},{"style":"important","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"in ‘extensions’ add the proper file extensions your language uses."}]}],"type":"aside","name":"Important"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now find the static constant "},{"type":"reference","isActive":true,"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage\/allLanguages"},{"type":"text","text":" and add your language to it:"}]},{"type":"codeListing","syntax":"swift","code":["static let allLanguages: [CodeLanguage] = [","    \/\/ other languages","    .{lang},","    \/\/ other languages","]"]},{"anchor":"TreeSitterModelswift","level":3,"type":"heading","text":"TreeSitterModel.swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a new query like so:"}]},{"type":"codeListing","syntax":"swift","code":["public private(set) lazy var {lang}Query: Query? = {","    return queryFor(.{lang})","}()"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Find the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterModel\/query(for:)"},{"type":"text","text":" method and add a "},{"type":"codeVoice","code":"case"},{"type":"text","text":" for your language:"}]},{"type":"codeListing","syntax":"swift","code":["public func query(for language: TreeSitterLanguage) -> Query? {","    switch language {","    \/\/ other cases","    case .{lang}:","        return {lang}Query","    \/\/ other cases","    }","}"]},{"anchor":"Test-it","level":2,"type":"heading","text":"Test it!"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Make sure to test the newly created language in a sample project!"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"When everything is working correctly push your "},{"type":"codeVoice","code":"tree-sitter-{lang}"},{"type":"text","text":" changes to "},{"type":"codeVoice","code":"origin"},{"type":"text","text":" and also create a Pull Request to the official repository."}]},{"style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Take "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/tree-sitter\/tree-sitter-javascript\/pull\/223"},{"type":"text","text":" as a template and cross-reference it with your Pull Request."}]}],"type":"aside","name":"Tip"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now you can remove the local dependencies and replace it with the actual package URLs and submit a Pull Request for "},{"type":"codeVoice","code":"CodeEditTextView"},{"type":"text","text":"."}]},{"anchor":"Unit-Tests","level":2,"type":"heading","text":"Unit Tests"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Also make sure to add test cases for your new language in "},{"type":"codeVoice","code":"Tests\/CodeEditLanguagesTests"},{"type":"text","text":"."}]},{"anchor":"Example","level":3,"type":"heading","text":"Example"},{"type":"codeListing","syntax":"swift","code":["\/\/ MARK: - Swift","","    \/\/ create as many test cases as there are file extensions","    func test_CodeLanguageSwift() throws {","        let url = URL(fileURLWithPath: \"~\/path\/to\/file.swift\")","        let language = CodeLanguage.detectLanguageFrom(url: url)","","        XCTAssertEqual(language.id, .swift)","    }","","    func test_FetchQuerySwift() throws {","        var language = CodeLanguage.swift","        language.resourceURL = bundleURL","","        let data = try Data(contentsOf: language.queryURL!)","        let query = try? Query(language: language.language!, data: data)","        XCTAssertNotNil(query)","        XCTAssertNotEqual(query?.patternCount, 0)","    }"]},{"anchor":"Run-Tests-locally","level":3,"type":"heading","text":"Run Tests locally"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once you added your unit test cases run all tests locally on your machine by going to "},{"type":"codeVoice","code":"Product>Test"},{"type":"text","text":" or pressing "},{"type":"codeVoice","code":"⌘+U"},{"type":"text","text":" to make sure everything is working as intended."},{"type":"text","text":" "},{"type":"image","identifier":"tests-results"}]},{"anchor":"Documentation","level":2,"type":"heading","text":"Documentation"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Please make sure to add the newly created properties to the documentation "},{"type":"codeVoice","code":"*.md"},{"type":"text","text":" files in the "},{"type":"codeVoice","code":"Documentation.docc"},{"type":"text","text":" catalog."},{"type":"text","text":" "},{"type":"image","identifier":"docs-location"}]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/codeeditlanguages\/add-languages"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/Add-Languages","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"This article is a writedown on how to add support for more languages to "},{"type":"reference","isActive":true,"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage"},{"type":"text","text":"."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Add Languages","role":"article","modules":[{"name":"CodeEditLanguages"}]},"hierarchy":{"paths":[["doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages"],["doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages","doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage"]]},"seeAlsoSections":[{"title":"Guides","identifiers":["doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/Update-Languages"],"generated":true}],"references":{"doc://CodeEditLanguages/documentation/CodeEditLanguages/CodeLanguage":{"role":"symbol","title":"CodeLanguage","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"CodeLanguage"}],"abstract":[{"type":"text","text":"A structure holding metadata for code languages"}],"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"CodeLanguage"}],"url":"\/documentation\/codeeditlanguages\/codelanguage"},"tests-results":{"alt":"unit test results","type":"image","identifier":"tests-results","variants":[{"url":"\/images\/tests-results.png","traits":["1x","light"]}]},"https://github.com/tree-sitter/tree-sitter-javascript/pull/223":{"title":"this PR description","titleInlineContent":[{"type":"text","text":"this PR description"}],"type":"link","identifier":"https:\/\/github.com\/tree-sitter\/tree-sitter-javascript\/pull\/223","url":"https:\/\/github.com\/tree-sitter\/tree-sitter-javascript\/pull\/223"},"doc://CodeEditLanguages/documentation/CodeEditLanguages/Update-Languages":{"role":"article","title":"Update Languages","abstract":[{"type":"text","text":"This article covers all the steps needed to update to the latest version of the "},{"type":"codeVoice","code":"tree-sitter"},{"type":"text","text":" languages."}],"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/Update-Languages","kind":"article","type":"topic","url":"\/documentation\/codeeditlanguages\/update-languages"},"doc://CodeEditLanguages/documentation/CodeEditLanguages/TreeSitterModel/query(for:)":{"role":"symbol","title":"query(for:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"query"},{"kind":"text","text":"("},{"kind":"externalParam","text":"for"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"TreeSitterLanguage","preciseIdentifier":"s:17CodeEditLanguages18TreeSitterLanguageO"},{"kind":"text","text":") -> "},{"kind":"typeIdentifier","text":"Query","preciseIdentifier":"s:15SwiftTreeSitter5QueryC"},{"kind":"text","text":"?"}],"abstract":[{"type":"text","text":"Get a query for a specific language"}],"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterModel\/query(for:)","kind":"symbol","type":"topic","url":"\/documentation\/codeeditlanguages\/treesittermodel\/query(for:)"},"build-output":{"alt":"build_framework.sh console output","type":"image","identifier":"build-output","variants":[{"url":"\/images\/build-output.png","traits":["1x","light"]}]},"doc://CodeEditLanguages/documentation/CodeEditLanguages":{"role":"collection","title":"CodeEditLanguages","abstract":[{"type":"text","text":"A collection of "},{"type":"codeVoice","code":"tree-sitter"},{"type":"text","text":" languages for syntax highlighting."}],"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages","kind":"symbol","type":"topic","url":"\/documentation\/codeeditlanguages"},"doc://CodeEditLanguages/documentation/CodeEditLanguages/TreeSitterLanguage":{"role":"symbol","title":"TreeSitterLanguage","fragments":[{"kind":"keyword","text":"enum"},{"kind":"text","text":" "},{"kind":"identifier","text":"TreeSitterLanguage"}],"abstract":[{"type":"text","text":"A collection of languages that are supported by "},{"type":"codeVoice","code":"tree-sitter"}],"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterLanguage","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"TreeSitterLanguage"}],"url":"\/documentation\/codeeditlanguages\/treesitterlanguage"},"xcodeproj-location":{"alt":".xcodeproj location","type":"image","identifier":"xcodeproj-location","variants":[{"url":"\/images\/xcodeproj-location.png","traits":["1x","light"]}]},"doc://CodeEditLanguages/documentation/CodeEditLanguages/CodeLanguage/allLanguages":{"role":"symbol","title":"allLanguages","fragments":[{"kind":"keyword","text":"static"},{"kind":"text","text":" "},{"kind":"keyword","text":"let"},{"kind":"text","text":" "},{"kind":"identifier","text":"allLanguages"},{"kind":"text","text":": ["},{"kind":"typeIdentifier","text":"CodeLanguage","preciseIdentifier":"s:17CodeEditLanguages0A8LanguageV"},{"kind":"text","text":"]"}],"abstract":[{"type":"text","text":"An array of all language structures."}],"identifier":"doc:\/\/CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage\/allLanguages","kind":"symbol","type":"topic","url":"\/documentation\/codeeditlanguages\/codelanguage\/alllanguages"},"docs-location":{"alt":"docs location","type":"image","identifier":"docs-location","variants":[{"url":"\/images\/docs-location.png","traits":["1x","light"]}]},"https://github.com/CodeEditApp/CodeEditTextView/issues/15":{"title":"GitHub Issue","titleInlineContent":[{"type":"text","text":"GitHub Issue"}],"type":"link","identifier":"https:\/\/github.com\/CodeEditApp\/CodeEditTextView\/issues\/15","url":"https:\/\/github.com\/CodeEditApp\/CodeEditTextView\/issues\/15"}}}